!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComplexArray=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.FFT=function(e){return h(e).FFT()},t.InvFFT=function(e){return h(e).InvFFT()},t.frequencyMap=function(e,t){return h(e).frequencyMap(t)};var a,o=r(1),i=(a=o)&&a.__esModule?a:{default:a};function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=Math.PI,c=Math.SQRT1_2;var s=t.ComplexArray=function(e){function t(){return u(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"FFT",value:function(){return p(this,!1)}},{key:"InvFFT",value:function(){return p(this,!0)}},{key:"frequencyMap",value:function(e){return this.FFT().map(e).InvFFT()}}]),t}(i.default);function h(e){return e instanceof s&&e||new s(e)}function p(e,t){var r=e.length;return r&r-1?function(e,t){var r=e.length;if(1===r)return e;for(var n=new s(r,e.ArrayType),a=function(e){var t=Math.sqrt(e),r=3;for(;r<=t;){if(e%r==0)return r;r+=2}return e}(r),o=r/a,i=1/Math.sqrt(a),u=new s(o,e.ArrayType),l=0;l<a;l++){for(var c=0;c<o;c++)u.real[c]=e.real[c*a+l],u.imag[c]=e.imag[c*a+l];o>1&&(u=p(u,t));for(var h=Math.cos(2*f*l/r),y=(t?-1:1)*Math.sin(2*f*l/r),g=1,v=0,m=0;m<r;m++){var d=u.real[m%o],w=u.imag[m%o];n.real[m]+=g*d-v*w,n.imag[m]+=g*w+v*d;var b=[g*h-v*y,v=g*y+v*h];g=b[0],v=b[1]}}for(var M=0;M<r;M++)e.real[M]=i*n.real[M],e.imag[M]=i*n.imag[M];return e}(e,t):function(e,t){var r=e.length,n=function(e){for(var t=e.length,r=new Set,n=0;n<t;n++){var a=y(n,t);if(!r.has(n)){var o=[e.real[a],e.real[n]];e.real[n]=o[0],e.real[a]=o[1];var i=[e.imag[a],e.imag[n]];e.imag[n]=i[0],e.imag[a]=i[1],r.add(a)}}return e}(e),a=n.real,o=n.imag,i=1;for(;i<r;){for(var u=Math.cos(f/i),l=(t?-1:1)*Math.sin(f/i),s=0;s<r/(2*i);s++)for(var h=1,p=0,g=0;g<i;g++){var v=2*s*i+g,m=v+i,d=a[v],w=o[v],b=h*a[m]-p*o[m],M=p*a[m]+h*o[m];a[v]=c*(d+b),o[v]=c*(w+M),a[m]=c*(d-b),o[m]=c*(w-M);var F=[h*u-p*l,h*l+p*u];h=F[0],p=F[1]}i<<=1}return n}(e,t)}function y(e,t){for(var r=0;t>1;)r<<=1,r+=1&e,e>>=1,t>>=1;return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array;a(this,e),t instanceof e?(this.ArrayType=t.ArrayType,this.real=new this.ArrayType(t.real),this.imag=new this.ArrayType(t.imag)):(this.ArrayType=r,this.real=new this.ArrayType(t),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length}return n(e,[{key:"toString",value:function(){var e=[];return this.forEach((function(t,r){e.push("("+t.real.toFixed(2)+", "+t.imag.toFixed(2)+")")})),"["+e.join(", ")+"]"}},{key:"forEach",value:function(e){for(var t=this.length,r=Object.seal(Object.defineProperties({},{real:{writable:!0},imag:{writable:!0}})),n=0;n<t;n++)r.real=this.real[n],r.imag=this.imag[n],e(r,n,t)}},{key:"map",value:function(e){var t=this;return this.forEach((function(r,n,a){e(r,n,a),t.real[n]=r.real,t.imag[n]=r.imag})),this}},{key:"conjugate",value:function(){return new e(this).map((function(e){e.imag*=-1}))}},{key:"magnitude",value:function(){var e=new this.ArrayType(this.length);return this.forEach((function(t,r){e[r]=Math.sqrt(t.real*t.real+t.imag*t.imag)})),e}}]),e}();t.default=o},function(e,t,r){"use strict";r.r(t);var n=r(0);function a(e){return 2595*Math.log10(1+e/700)}function o(e){return 700*(10**(e/2595)-1)}function i(e,t,r){return e+r*(t-e)}function u(e,t,r){return(e-r)/(e-t)}const l=[.27105140069342,-.43329793923448,.21812299954311,-.06592544638803,.01081174209837,-.00077658482522,1388721735e-14];function f(e,t){let r=0;for(let n=0;n<l.length;n+=1)r+=l[n]*Math.cos(2*Math.PI*n*e/t);return r}function c(e,t,r,l,c,s,h,p){for(let t=0;t<e.length;t+=1)e[t]*=f(t,e.length);const y=Object(n.FFT)(e);for(let n=0;n<p;n+=1){const f=u(0,p-1,n);let g;switch(h){case"linear":g=i(l,c,f)*e.length/s;break;case"mel":g=o(i(a(l),a(c),f))*e.length/s;break;default:throw new Error("Unknown scale")}const v=Math.floor(g),m=Math.ceil(g),d=i(Math.sqrt(y.real[v]**2+y.imag[v]**2),Math.sqrt(y.real[m]**2+y.imag[m]**2),g-v)/Math.sqrt(e.length);t[r+n]=d}}self.addEventListener("message",e=>{const{data:{action:t,payload:r}}=e;switch(t){case"spectrogram-compute":{const{samplesBuffer:e,samplesStart:t,samplesLength:n,options:a}=r;try{const r=new Float32Array(e),{windowCount:o,options:i,spectrogram:u}=function(e,t,r,{isStart:n=!1,isEnd:a=!1,windowSize:o=4096,windowStepSize:i=1024,minFrequencyHz:u,maxFrequencyHz:l,sampleRate:f,scale:s="linear",scaleSize:h}){if(void 0===u&&(u=0),void 0===l&&(l=f*(o-2)/(2*o)),void 0===h&&(h=o/2),o%i!=0)throw new Error("Window step size must be evenly divisible by the window size");let p=Math.ceil(r/i)-Math.floor(o/i)+1,y=t;if(n||a){const e=Math.floor(o/i)-1;n&&(p+=e,y-=e*i),a&&(p+=e)}const g=new Float32Array(h*p),v=new Float32Array(o);for(let n=y,a=0;a<p*h;n+=i,a+=h){for(let a=0;a<o;a+=1){const o=n+a;v[a]=o<t||o>=t+r?0:e[o]}c(v,g,a,u,l,f,s,h)}return{windowCount:p,options:{isStart:n,isEnd:a,windowSize:o,windowStepSize:i,minFrequencyHz:u,maxFrequencyHz:l,sampleRate:f,scale:s,scaleSize:h},spectrogram:g}}(r,t,n,a),l={payload:{spectrogramWindowCount:o,spectrogramOptions:i,spectrogramBuffer:u.buffer,inputBuffer:r.buffer}};self.postMessage(l,[u.buffer,r.buffer])}catch(e){const t={error:e};self.postMessage(t)}break}default:self.postMessage({error:new Error("Unknown action")})}})}]);